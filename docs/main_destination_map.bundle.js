(()=>{"use strict";const e={"boundary-tiles":{type:"vector",url:"https://tiles.dvrpc.org/data/census_boundaries.json"},"sidewalk-tiles":{type:"vector",url:"https://tiles.dvrpc.org/data/pedestrian-network.json"},"mcpcv1-tiles":{type:"vector",url:"https://tiles.dvrpc.org/data/sidewalk-prioritiesv3.json"}},t="62, 207, 150",i="178, 100, 168";var o=["all",["==","src_network","pedestriannetwork_lines"]],s=["all",["==","src_network","osm_edges_all_no_motorway"]];const l={montco:{id:"montco",type:"line",source:"boundary-tiles","source-layer":"county",layout:{},paint:{"line-width":10,"line-opacity":.4,"line-color":"black"},filter:["==","CNTY_NAME","Montgomery County"]},iso_osm:{id:"iso_osm",type:"fill",source:"mcpcv1-tiles","source-layer":"mcpc_isos",paint:{"fill-color":"rgba("+i+", 0.5)","fill-opacity":0},filter:s},iso_osm_outline:{id:"iso_osm_outline",type:"line",source:"mcpcv1-tiles","source-layer":"mcpc_isos",paint:{"line-color":"rgba("+i+", 0.5)","line-opacity":0,"line-width":3,"line-dasharray":[2,1.5,1,1.5]},filter:s},iso_sw:{id:"iso_sw",type:"fill",source:"mcpcv1-tiles","source-layer":"mcpc_isos",paint:{"fill-color":"rgba("+t+", 0.5)","fill-opacity":0},filter:o},iso_sw_outline:{id:"iso_sw_outline",type:"line",source:"mcpcv1-tiles","source-layer":"mcpc_isos",paint:{"line-color":"rgba("+t+", 0.5)","line-opacity":0,"line-width":3,"line-dasharray":[2,1.5,1,1.5]},filter:o}},r={sw:{id:"sw",type:"line",source:"sidewalk-tiles","source-layer":"ped_lines",paint:{"line-width":4,"line-opacity":.2,"line-color":"black"},layout:{visibility:"visible"},filter:["all",["==","line_type",1],["==","county","MONTGOMERY"]]},xwalk:{id:"xwalk",type:"line",source:"sidewalk-tiles","source-layer":"ped_lines",paint:{"line-width":9,"line-opacity":.2,"line-color":"black"},layout:{visibility:"visible"},filter:["all",["==","line_type",2],["==","county","MONTGOMERY"]]},selected_poi_entrypoints:{id:"selected_poi_entrypoints",type:"circle",source:"mcpcv1-tiles","source-layer":"pois_full",layout:{},paint:{"circle-radius":4,"circle-opacity":1,"circle-stroke-opacity":1,"circle-stroke-width":1,"circle-color":"black","circle-stroke-color":"white"},filter:["==","type","none - this filter should return zero results"]},all_pois:{id:"all_pois",type:"circle",source:"mcpcv1-tiles","source-layer":"pois_centroids",layout:{},paint:{"circle-radius":6,"circle-opacity":1,"circle-stroke-opacity":1,"circle-stroke-color":"black","circle-stroke-width":1,"circle-color":{property:"ab_ratio",default:"black",stops:[[0,"rgba(0, 0, 0, 1)"],[1e-4,"rgba(255, 0, 0, 1)"],[.1,"rgba(255, 153, 0, 1)"],[.5,"rgba(255, 255, 0, 1)"],[1,"rgba(0, 153, 0, 1)"]]}}},selected_poi:{id:"selected_poi",type:"circle",source:"mcpcv1-tiles","source-layer":"pois_centroids",layout:{},paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-opacity":0,"circle-stroke-width":8,"circle-stroke-color":"black"},filter:["==","type","none - this filter should return zero results"]}},a=(e,t)=>{var i=new XMLHttpRequest;i.open("GET","https://omad-api-lf2k9.ondigitalocean.app/sidewalk/nearby-gaps/?q=1007",!0),i.setRequestHeader("Access-Control-Allow-Origin","*"),i.onload=function(){if(this.status>=200&&this.status<400){var i=JSON.parse(this.response);e.addSource("missing-links",{type:"geojson",data:i}),e.addLayer({id:"missing-links-for-selected-poi",type:"line",source:"missing-links",paint:{"line-opacity":0,"line-color":"rgb(57,83,164)","line-width":{property:"island_count",default:100,stops:[[0,1],[1,5],[2,10]]}}},t)}},i.send()},n=(e,t)=>{let i="https://omad-api-lf2k9.ondigitalocean.app/sidewalk/nearby-gaps/?q="+t;var o=new XMLHttpRequest;o.open("GET",i,!0),o.setRequestHeader("Access-Control-Allow-Origin","*"),o.onload=function(){if(this.status>=200&&this.status<400){var t=JSON.parse(this.response);e.getSource("missing-links").setData(t),e.setPaintProperty("missing-links-for-selected-poi","line-opacity",.5)}},o.send()},c=e=>{try{var t=e.split(" ").map((e=>e[0].toUpperCase()+e.substr(1).toLowerCase())).join(" ")}catch{t=e}return t},p=e=>{var t=100*e;if(t>100&&(t=100),100==t)var i="100%";else if(0==t)i="No";else if(t<0)i="Only";else i=String(t.toFixed(1))+"%";return i},d=(e,t)=>{var i="https://omad-api-lf2k9.ondigitalocean.app/sidewalk/walkshed-area/?q="+t,o=new XMLHttpRequest;o.open("GET",i,!0),o.setRequestHeader("Access-Control-Allow-Origin","*"),o.onload=function(){if(this.status>=200&&this.status<400){var t=JSON.parse(this.response);e.data.datasets[0].data=[t.pedestriannetwork_lines.area_in_square_miles],e.data.datasets[1].data=[t.osm_edges_all_no_motorway.area_in_square_miles],e.update()}},o.send()},u=(e,t,i,l,r,a)=>{var u=["in","poi_uid",i=parseInt(i)],y=["in","eta_uid",i.toString()];n(e,i),d(t,i),e.setFilter("iso_sw",["all",y,o]),e.setFilter("iso_sw_outline",["all",y,o]),e.setFilter("iso_osm",["all",y,s]),e.setFilter("iso_osm_outline",["all",y,s]),e.setFilter("selected_poi",u),e.setFilter("selected_poi_entrypoints",u),e.flyTo({center:l,zoom:14,essential:!0}),e.getCanvas().style.cursor="",document.getElementById("selected-poi-name").innerHTML=c(decodeURI(r)),document.getElementById("selected-poi-ratio").innerHTML=p(a)+" sidewalk coverage",e.setPaintProperty("iso_sw","fill-opacity",.7),e.setPaintProperty("iso_osm","fill-opacity",.7),e.setPaintProperty("iso_sw_outline","line-opacity",.9),e.setPaintProperty("iso_osm_outline","line-opacity",.9),e.setPaintProperty("selected_poi","circle-stroke-opacity",1),document.getElementById("info-box").style.setProperty("visibility","visible"),document.getElementById("walkshed-legend").style.setProperty("display","inline")},y=(e,t,i)=>{new mapboxgl.Popup({closeButton:!1,className:"i-am-a-popup"}).setLngLat(i.lngLat).setHTML(t).addTo(e)},_=()=>{var e=document.getElementsByClassName("mapboxgl-popup");e.length&&e[0].remove()};mapboxgl.accessToken="pk.eyJ1IjoiYWFyb25kdnJwYyIsImEiOiJja2NvN2s5dnAwaWR2MnptbzFwYmd2czVvIn0.Fcc34gzGME_zHR5q4RnSOg";const m={sidewalks:{id:"sw",attribute:"line-width",style:["interpolate",["exponential",.5],["zoom"],10,.01,17,3]},crosswalks:{id:"xwalk",attribute:"line-width",style:["interpolate",["exponential",.5],["zoom"],10,.05,18,6]},all_pois:{id:"all_pois",attribute:"circle-radius",style:["interpolate",["linear"],["zoom"],10,4,18,8]},selected_poi:{id:"selected_poi",attribute:"circle-radius",style:["interpolate",["linear"],["zoom"],10,5,18,20]}},g=new mapboxgl.Map({container:"map",style:"mapbox://styles/aarondvrpc/ckqhcmx6x95x318pgqzt4jicq",center:[-75.36277290123333,40.20129661107534],zoom:10}),w=(()=>{const e=document.getElementById("barChart");return new Chart(e,{type:"bar",data:{labels:[""],datasets:[{label:"Using existing sidewalks only",backgroundColor:"rgba("+t+", 0.5)",borderColor:"rgba("+t+", 0.5)",data:[50]},{label:"If every road had sidewalks",backgroundColor:"rgba("+i+", 0.5)",borderColor:"rgba("+i+", 0.5)",data:[100]}]},options:{indexAxis:"y",maintainAspectRatio:!1}})})();g.on("load",(function(){d(w,"1007");for(const t in e)g.addSource(t,e[t]);for(const e in l)g.addLayer(l[e],"road-label");a(g,"road-label");for(const e in r)g.addLayer(r[e],"road-label");for(const e in m)g.setPaintProperty(m[e].id,m[e].attribute,m[e].style);((e,t)=>{e.on("click","all_pois",(function(i){var o=i.features[0].properties;u(e,t,o.poi_uid,i.lngLat,o.poi_name,o.ab_ratio)}))})(g,w),(e=>{["all_pois"].forEach((t=>((e,t)=>{e.on("mouseenter",t,(()=>e.getCanvas().style.cursor="pointer")),e.on("mouseleave",t,(function(t){e.getCanvas().style.cursor=""}))})(e,t))),e.on("mouseenter","all_pois",(function(t){var i=t.features[0].properties,o="<h3>"+c(i.poi_name)+"</h3>";o+="<p style='text-align: center;'>"+p(i.ab_ratio)+" sidewalk coverage</p>",y(e,o,t)})),e.on("mouseleave","all_pois",(function(e){_()}))})(g),(e=>{var t=document.getElementById("dropdown_category"),i=document.getElementById("subtitle"),o={all:"All Points of Interest","Public School":"Public Schools","Private School":"Private Schools","School - College, University":"Colleges/Universities","Health Facility":"Health Care Facilities","Food Store":"Food Stores","Activity Center for Seniors or Disabled":"Activity Centers for Senior/Disabled","Municipal Buildings":"Municipal Buildings",trailhead:"Trailheads",Libraries:"Libraries","Shopping Centers":"Shopping Centers"};t.addEventListener("change",(function(){if(i.innerHTML=o[t.value],"all"==t.value)var s=null;else s=["==","category",t.value];e.setFilter("all_pois",s),e.setFilter("iso_sw",["==","src_network","none"]),e.setFilter("iso_osm",["==","src_network","none"]),e.setFilter("iso_sw_outline",["==","src_network","none"]),e.setFilter("iso_osm_outline",["==","src_network","none"]),e.setFilter("selected_poi",["==","type","none"]),e.setPaintProperty("missing-links-for-selected-poi","line-opacity",0),document.getElementById("info-box").style.setProperty("visibility","hidden"),document.getElementById("walkshed-legend").style.setProperty("display","none"),_(),e.flyTo({center:[-75.36277290123333,40.20129661107534],zoom:10,essential:!0})}))})(g);let t=(()=>{let e=new URLSearchParams(window.location).get("search");if(""==e)return null;{let t={};return e.split("&").forEach((e=>{let i=(e=e.replace("?","")).split("=");t[i[0]]=i[1]})),t}})();t&&(console.log(t),u(g,w,t.id,[t.lng,t.lat],t.name.replace("_"," "),t.ab_ratio))}))})();