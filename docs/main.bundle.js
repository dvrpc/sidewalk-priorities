(()=>{"use strict";const e={"boundary-tiles":{type:"vector",url:"https://tiles.dvrpc.org/data/census_boundaries.json"},"sidewalk-tiles":{type:"vector",url:"https://tiles.dvrpc.org/data/pedestrian-network.json"},"mcpcv1-tiles":{type:"vector",url:"https://tiles.dvrpc.org/data/sidewalk-priorities.json"}};var t=["all",["==","src_network","pedestriannetwork_lines"]],i=["all",["==","src_network","osm_edges_all"]];const o={montco:{id:"montco",type:"line",source:"boundary-tiles","source-layer":"county",layout:{},paint:{"line-width":10,"line-opacity":.4,"line-color":"black"},filter:["==","CNTY_NAME","Montgomery County"]},iso_osm:{id:"iso_osm",type:"fill",source:"mcpcv1-tiles","source-layer":"eta_isos",paint:{"fill-color":"black","fill-opacity":0},filter:i},iso_sw:{id:"iso_sw",type:"fill",source:"mcpcv1-tiles","source-layer":"eta_isos",paint:{"fill-color":"purple","fill-opacity":0},filter:t}},l={sw:{id:"sw",type:"line",source:"sidewalk-tiles","source-layer":"ped_lines",paint:{"line-width":4,"line-opacity":.2,"line-color":"black"},layout:{visibility:"visible"},filter:["all",["==","line_type",1],["==","county","MONTGOMERY"]]},xwalk:{id:"xwalk",type:"line",source:"sidewalk-tiles","source-layer":"ped_lines",paint:{"line-width":9,"line-opacity":.2,"line-color":"black"},layout:{visibility:"visible"},filter:["all",["==","line_type",2],["==","county","MONTGOMERY"]]},all_pois:{id:"all_pois",type:"circle",source:"mcpcv1-tiles","source-layer":"eta_points",layout:{},paint:{"circle-radius":6,"circle-opacity":.6,"circle-stroke-opacity":.6,"circle-stroke-color":"black","circle-stroke-width":1,"circle-color":{property:"ab_ratio",default:"black",stops:[[-1,"rgba(255, 255, 255, 1)"],[0,"rgba(255, 0, 0, 1)"],[.7,"rgba(255, 255, 0, 1)"],[1,"rgba(0, 153, 0, 1)"],[2,"rgba(0, 153, 0, 1)"]]}}},selected_poi:{id:"selected_poi",type:"circle",source:"mcpcv1-tiles","source-layer":"eta_points",layout:{},paint:{"circle-radius":20,"circle-opacity":1,"circle-stroke-opacity":0,"circle-stroke-width":8,"circle-stroke-color":"black","circle-color":{property:"ab_ratio",default:"black",stops:[[-1,"rgba(255, 255, 255, 1)"],[0,"rgba(255, 0, 0, 1)"],[.7,"rgba(255, 255, 0, 1)"],[1,"rgba(0, 153, 0, 1)"],[2,"rgba(0, 153, 0, 1)"]]}},filter:["==","type","none - this filter should return zero results"]}},s=()=>{var e="https://omad-api-lf2k9.ondigitalocean.app";return console.log("Env is production"),console.log("URL is ",e),e},r=(e,t)=>{let i=s()+"/sidewalk/nearby-gaps/?q=1007";var o=new XMLHttpRequest;o.open("GET",i,!0),o.setRequestHeader("Access-Control-Allow-Origin","*"),o.onload=function(){if(this.status>=200&&this.status<400){var i=JSON.parse(this.response);e.addSource("missing-links",{type:"geojson",data:i}),e.addLayer({id:"missing-links-for-selected-poi",type:"line",source:"missing-links",paint:{"line-width":4,"line-opacity":0,"line-color":"yellow"}},t)}},o.send()},a=(e,t)=>{let i=s()+"/sidewalk/nearby-gaps/?q="+t;var o=new XMLHttpRequest;o.open("GET",i,!0),o.setRequestHeader("Access-Control-Allow-Origin","*"),o.onload=function(){if(this.status>=200&&this.status<400){var t=JSON.parse(this.response);e.getSource("missing-links").setData(t),e.setPaintProperty("missing-links-for-selected-poi","line-opacity",.5)}},o.send()},n=e=>{e.on("click","all_pois",(function(o){var l=o.features[0].properties,s=["in","eta_uid",l.eta_uid],r=["in","eta_uid",l.eta_uid.toString()];a(e,l.eta_uid),e.setFilter("iso_sw",["all",r,t]),e.setFilter("iso_osm",["all",r,i]),e.setFilter("selected_poi",s),e.flyTo({center:o.lngLat,zoom:14,essential:!0}),e.getCanvas().style.cursor="",document.getElementById("selected-poi-name").innerHTML=l.name.split(" ").map((e=>e[0].toUpperCase()+e.substr(1).toLowerCase())).join(" "),document.getElementById("selected-poi-ratio").innerHTML=(e=>{var t=100*e;if(t>100&&(t=100),100==t)var i="100%";else i=0==t?"No":String(t.toFixed(1))+"%";return i})(l.ab_ratio)+" sidewalk coverage",e.setPaintProperty("iso_sw","fill-opacity",.4),e.setPaintProperty("iso_osm","fill-opacity",.2),e.setPaintProperty("selected_poi","circle-stroke-opacity",1),document.getElementById("info-box").style.setProperty("visibility","visible")}))};mapboxgl.accessToken="pk.eyJ1IjoiYWFyb25kdnJwYyIsImEiOiJja2NvN2s5dnAwaWR2MnptbzFwYmd2czVvIn0.Fcc34gzGME_zHR5q4RnSOg";const c={sidewalks:{id:"sw",attribute:"line-width",style:["interpolate",["exponential",.5],["zoom"],10,.01,17,3]},crosswalks:{id:"xwalk",attribute:"line-width",style:["interpolate",["exponential",.5],["zoom"],10,.05,18,6]},all_pois:{id:"all_pois",attribute:"circle-radius",style:["interpolate",["linear"],["zoom"],10,4,18,8]},selected_poi:{id:"selected_poi",attribute:"circle-radius",style:["interpolate",["linear"],["zoom"],10,5,18,20]}},p=new mapboxgl.Map({container:"map",style:"mapbox://styles/aarondvrpc/ckqhcmx6x95x318pgqzt4jicq",center:[-75.36277290123333,40.20129661107534],zoom:10});p.on("load",(function(){for(const t in e)p.addSource(t,e[t]);for(const e in o)p.addLayer(o[e],"road-label");r(p,"road-label");for(const e in l)p.addLayer(l[e],"road-label");for(const e in c)p.setPaintProperty(c[e].id,c[e].attribute,c[e].style);n(p),(e=>{["all_pois"].forEach((t=>((e,t)=>{e.on("mouseenter",t,(()=>e.getCanvas().style.cursor="pointer")),e.on("mouseleave",t,(function(t){e.getCanvas().style.cursor=""}))})(e,t)))})(p)}));var d=document.getElementById("dropdown_category"),y=document.getElementById("subtitle"),u={all:"All Points of Interest","School - Public":"Public Schools","School - Private":"Private Schools","School - College, University":"Colleges/Universities","Health Facility":"Health Care Facilities","Food Store":"Food Stores","Activity Center for Seniors or Disabled":"Activity Centers for Senior/Disabled"};d.addEventListener("change",(function(){if(y.innerHTML=u[d.value],"all"==d.value)var e=null;else e=["==","type",d.value];p.setFilter("all_pois",e),p.setFilter("iso_sw",["==","src_network","none"]),p.setFilter("iso_osm",["==","src_network","none"]),p.setFilter("selected_poi",["==","type","none"]),p.setPaintProperty("missing-links-for-selected-poi","line-opacity",0),document.getElementById("info-box").style.setProperty("visibility","hidden");const t=document.getElementsByClassName("mapboxgl-popup");t.length&&t[0].remove(),p.flyTo({center:[-75.36277290123333,40.20129661107534],zoom:10,essential:!0})}))})();