(()=>{"use strict";const e={"boundary-tiles":{type:"vector",url:"https://tiles.dvrpc.org/data/census_boundaries.json"},"sidewalk-tiles":{type:"vector",url:"https://tiles.dvrpc.org/data/pedestrian-network.json"},"mcpcv1-tiles":{type:"vector",url:"https://tiles.dvrpc.org/data/sidewalk-prioritiesv3.json"}},t="62, 207, 150",i="178, 100, 168";var o=["all",["==","src_network","pedestriannetwork_lines"]],s=["all",["==","src_network","osm_edges_all_no_motorway"]];const l={montco:{id:"montco",type:"line",source:"boundary-tiles","source-layer":"county",layout:{},paint:{"line-width":10,"line-opacity":.4,"line-color":"black"},filter:["==","CNTY_NAME","Montgomery County"]},iso_osm:{id:"iso_osm",type:"fill",source:"mcpcv1-tiles","source-layer":"mcpc_isos",paint:{"fill-color":"rgba("+i+", 0.5)","fill-opacity":0},filter:s},iso_osm_outline:{id:"iso_osm_outline",type:"line",source:"mcpcv1-tiles","source-layer":"mcpc_isos",paint:{"line-color":"rgba("+i+", 0.5)","line-opacity":0,"line-width":3,"line-dasharray":[2,1.5,1,1.5]},filter:s},iso_sw:{id:"iso_sw",type:"fill",source:"mcpcv1-tiles","source-layer":"mcpc_isos",paint:{"fill-color":"rgba("+t+", 0.5)","fill-opacity":0},filter:o},iso_sw_outline:{id:"iso_sw_outline",type:"line",source:"mcpcv1-tiles","source-layer":"mcpc_isos",paint:{"line-color":"rgba("+t+", 0.5)","line-opacity":0,"line-width":3,"line-dasharray":[2,1.5,1,1.5]},filter:o}},a={sw:{id:"sw",type:"line",source:"sidewalk-tiles","source-layer":"ped_lines",paint:{"line-width":4,"line-opacity":.2,"line-color":"black"},layout:{visibility:"visible"},filter:["all",["==","line_type",1],["==","county","MONTGOMERY"]]},xwalk:{id:"xwalk",type:"line",source:"sidewalk-tiles","source-layer":"ped_lines",paint:{"line-width":9,"line-opacity":.2,"line-color":"black"},layout:{visibility:"visible"},filter:["all",["==","line_type",2],["==","county","MONTGOMERY"]]},selected_poi_entrypoints:{id:"selected_poi_entrypoints",type:"circle",source:"mcpcv1-tiles","source-layer":"pois_full",layout:{},paint:{"circle-radius":4,"circle-opacity":1,"circle-stroke-opacity":1,"circle-stroke-width":1,"circle-color":"black","circle-stroke-color":"white"},filter:["==","type","none - this filter should return zero results"]},all_pois:{id:"all_pois",type:"circle",source:"mcpcv1-tiles","source-layer":"pois_centroids",layout:{},paint:{"circle-radius":6,"circle-opacity":1,"circle-stroke-opacity":1,"circle-stroke-color":"black","circle-stroke-width":1,"circle-color":{property:"ab_ratio",default:"white",stops:[[0,"rgba(255, 255, 255, 0.8)"],[1e-4,"rgba(255, 0, 0, 1)"],[.1,"rgba(255, 153, 0, 1)"],[.5,"rgba(255, 255, 0, 1)"],[1,"rgba(0, 153, 0, 1)"]]}}},selected_poi:{id:"selected_poi",type:"circle",source:"mcpcv1-tiles","source-layer":"pois_centroids",layout:{},paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-opacity":0,"circle-stroke-width":8,"circle-stroke-color":"black"},filter:["==","type","none - this filter should return zero results"]}},r=e=>{["iso_sw","iso_osm","iso_sw_outline","iso_osm_outline"].forEach((t=>{e.setFilter(t,["==","src_network","none"])}))},n=e=>{r(e);["gaps","clicked_gap","selected-municipality","selected_existing_sidewalk"].forEach((t=>{e.setPaintProperty(t,"line-opacity",0)}));["selected_poi","selected_pois"].forEach((t=>{e.setPaintProperty(t,"circle-stroke-opacity",0)})),e.setFilter("selected_poi_entrypoints",["==","type","none - this filter should return zero results"])},c=e=>{document.getElementById(e).style.setProperty("display","none")},p=e=>{document.getElementById(e).style.setProperty("display","block")},d=e=>{document.getElementById(e).style.setProperty("display","inline")},u=(e,t)=>{document.getElementById(t).innerHTML=e},y=e=>{try{var t=e.split(" ").map((e=>e[0].toUpperCase()+e.substr(1).toLowerCase())).join(" ")}catch{t=e}return t},g=e=>{var t=100*e;if(t>100&&(t=100),100==t)var i="100%";else if(0==t)i="No";else if(t<0)i="Only";else i=String(t.toFixed(1))+"%";return i},_={"Public School":"Public School","Private School":"Private School","School - College, University":"College/University","Health Facility":"Health Care Facility","Food Store":"Food Store","Activity Center for Seniors or Disabled":"Activity Center for Senior/Disabled","Municipal Buildings":"Municipal Building",Libraries:"Library","Shopping Centers":"Shopping Center",Parks:"Park","SEPTA regional rail":"SEPTA Regional Rail stop","SEPTA norristown high speed line":"SEPTA Norristown High Speed Line stop","SEPTA bus":"SEPTA Bus stop"},h={"Public School":"Public Schools","Private School":"Private Schools","School - College, University":"Colleges/Universities","Health Facility":"Health Care Facilities","Food Store":"Food Stores","Activity Center for Seniors or Disabled":"Activity Centers for Senior/Disabled","Municipal Buildings":"Municipal Buildings",Libraries:"Libraries","Shopping Centers":"Shopping Centers",Parks:"Parks","SEPTA regional rail":"SEPTA Regional Rail stops","SEPTA norristown high speed line":"SEPTA Norristown High Speed Line stops","SEPTA bus":"SEPTA Bus stops"},m=(e,t)=>{let i="";return i=1==t?_[e]:h[e],i},b=(e,t)=>{var i=(e=>{var t,i,o={};return e.features.forEach((e=>{e.geometry.coordinates.forEach((e=>{i=e[0],t=e[1],o.xMin=o.xMin<i?o.xMin:i,o.xMax=o.xMax>i?o.xMax:i,o.yMin=o.yMin<t?o.yMin:t,o.yMax=o.yMax>t?o.yMax:t}))})),o})(t);e.fitBounds([[i.xMin,i.yMin],[i.xMax,i.yMax]],{padding:200})},w=()=>{let e="https://cloud.dvrpc.org/api/mcosp/v1";return e},f=(e,t,i,o,s)=>{var l=new XMLHttpRequest;l.open("GET",t,!0),l.setRequestHeader("Access-Control-Allow-Origin","*"),l.onload=function(){if(this.status>=200&&this.status<400){var t=JSON.parse(this.response);e.addSource(o,{type:"geojson",data:t}),e.addLayer(s,i)}},l.send()},k=(e,t)=>{((e,t)=>{let i=w()+"/pois-near-gap/?q=60943",o="selected-pois";f(e,i,t,o,{id:"selected_pois",type:"circle",source:o,paint:{"circle-radius":15,"circle-opacity":0,"circle-stroke-opacity":0,"circle-color":"rgba(0,0,0,0)","circle-stroke-width":3,"circle-stroke-color":{property:"ab_ratio",default:"black",stops:[[0,"rgba(0, 0, 0, 1)"],[1e-4,"rgba(255, 0, 0, 1)"],[.1,"rgba(255, 153, 0, 1)"],[.5,"rgba(255, 255, 0, 1)"],[1,"rgba(0, 153, 0, 1)"]]}}})})(e,t),((e,t)=>{let i=w()+"/all-munis/",o="all-munis";f(e,i,t,o,{id:"all-municipalities",type:"line",source:o,paint:{"line-color":"black","line-opacity":.5,"line-width":.5}})})(e,t),((e,t)=>{let i=w()+"/one-muni/?q=Abington%20Township",o="one-muni";f(e,i,t,o,{source:o,id:"selected-municipality",type:"line",paint:{"line-color":"pink","line-opacity":0,"line-width":10}})})(e,t),((e,t)=>{let i=w()+"/nearby-gaps/?q=60943",o="gap-lines";f(e,i,t,o,{id:"gaps",type:"line",source:o,paint:{"line-color":"rgb(57,83,164)","line-opacity":0,"line-width":{property:"island_count",default:100,stops:[[0,1],[1,3],[2,8]]}}})})(e,t),((e,t)=>{let i=w()+"/nearby-gaps/?q=60943",o="selected-gap";f(e,i,t,o,{id:"clicked_gap",type:"line",source:o,paint:{"line-color":"yellow","line-opacity":1,"line-width":{property:"island_count",default:100,stops:[[0,3],[1,10],[2,20]]}}})})(e,t)},v=(e,t)=>{let i=w()+"/one-muni-centroid/?q="+t.replace(" ","%20");var o=new XMLHttpRequest;o.open("GET",i,!0),o.setRequestHeader("Access-Control-Allow-Origin","*"),o.onload=function(){if(this.status>=200&&this.status<400){var t=JSON.parse(this.response);e.flyTo({center:[t[0].x,t[0].y],zoom:13,essential:!0})}},o.send()},x=(e,t)=>{let i=w()+"/one-muni/?q="+t.replace(" ","%20");var o=new XMLHttpRequest;o.open("GET",i,!0),o.setRequestHeader("Access-Control-Allow-Origin","*"),o.onload=function(){if(this.status>=200&&this.status<400){var t=JSON.parse(this.response);e.getSource("one-muni").setData(t),e.setPaintProperty("selected-municipality","line-opacity",.8)}},o.send()},P=(e,t)=>{var i=new XMLHttpRequest;i.open("GET",t,!0),i.setRequestHeader("Access-Control-Allow-Origin","*"),i.onload=function(){if(this.status>=200&&this.status<400){var t=JSON.parse(this.response);e.getSource("gap-lines").setData(t),e.getSource("selected-gap").setData(t),e.setPaintProperty("gaps","line-opacity",.5),b(e,t)}},i.send()},S=(e,t)=>{let i=w()+"/pois-near-gap/?q="+t.toString();var o=new XMLHttpRequest;o.open("GET",i,!0),o.setRequestHeader("Access-Control-Allow-Origin","*"),o.onload=function(){if(this.status>=200&&this.status<400){var t=JSON.parse(this.response);e.getSource("selected-pois").setData(t),e.setPaintProperty("selected_pois","circle-stroke-opacity",1);var i=Object.keys(t.features).length;let o=[];t.features.forEach((e=>{let t=e.properties.category;o.push(t)}));const s={};for(const e of o)s[e]=s[e]?s[e]+1:1;let l='improve pedestrian connectivity to <span class="green-text" style="font-weight: bold">'+i+"</span> destinations within one mile: <ul>";for(const[e,t]of Object.entries(s).sort(((e,t)=>t[1]-e[1]))){let i=m(e,t);l+="<li>"+t.toString()+" "+i+"</li>"}l+="</ul>",u(l,"stat-destinations"),b(e,t)}},o.send()},E=(e,t)=>{let i=w()+"/pois-near-existing-sidewalk/?lng="+t.lng+"&lat="+t.lat;var o=new XMLHttpRequest;o.open("GET",i,!0),o.setRequestHeader("Access-Control-Allow-Origin","*"),o.onload=function(){if(this.status>=200&&this.status<400){var t=JSON.parse(this.response);e.getSource("selected-pois").setData(t),e.setPaintProperty("selected_pois","circle-stroke-opacity",1);var i=Object.keys(t.features).length;let o=[];t.features.forEach((e=>{let t=e.properties.category;o.push(t)}));const s={};for(const e of o)s[e]=s[e]?s[e]+1:1;let l='could provide pedestrian connectivity to <span class="green-text" style="font-weight: bold">'+i+"</span> destinations within one mile: <ul>";for(const[e,t]of Object.entries(s).sort(((e,t)=>t[1]-e[1]))){let i=m(e,t);l+="<li>"+t.toString()+" "+i+"</li>"}l+="</ul>",u(l,"stat-destinations"),b(e,t)}},o.send()},C=(e,t,i)=>{M(),new mapboxgl.Popup({closeButton:!1,className:"i-am-a-popup"}).setLngLat(i.lngLat).setHTML(t).addTo(e)},M=()=>{var e=document.getElementsByClassName("mapboxgl-popup");e.length&&e[0].remove()},A=12.99,L=(e,t)=>{var i=w()+"/walkshed-area/?q="+t,o=new XMLHttpRequest;o.open("GET",i,!0),o.setRequestHeader("Access-Control-Allow-Origin","*"),o.onload=function(){if(this.status>=200&&this.status<400){var t=JSON.parse(this.response);e.data.datasets[0].data=[t.pedestriannetwork_lines.area_in_square_miles],e.data.datasets[1].data=[t.osm_edges_all_no_motorway.area_in_square_miles],e.update()}},o.send()},T=[],q=(e=T)=>{e.forEach((e=>e.remove()))},F=(e,t,i=T)=>{q();let o=(new mapboxgl.Marker).setLngLat(t).addTo(e);return i.push(o),o},H=(e,t,i,o)=>{var s=["in","uid",t];e.setFilter("clicked_gap",s),F(e,i),r(e),e.setFilter("selected_poi",["==","type","none"]);let l="";var a;l=o<1?"add to the sidewalk network where none currently exists":1==o?'extend the coverage of  <span class="green-text" style="font-weight: bold">one</span> existing island':'connect <span class="green-text" style="font-weight: bold">'+o+"</span> existing sidewalk islands",u(l,"stat-island"),a="stat-island",document.getElementById(a).style.setProperty("display","list-item"),u("Near a Missing Gap","subtitle"),u("Filling this gap could:","gap-header"),S(e,t),p("stat-box"),c("info-box"),c("walkshed-legend"),p("selected-legend"),e.setFilter("selected_poi_entrypoints",["==","type","none - this filter should return zero results"]),e.setPaintProperty("clicked_gap","line-opacity",.8),e.setPaintProperty("selected_existing_sidewalk","line-opacity",0),document.getElementById("dropdown_category").value="all",e.setFilter("all_pois",null)},O=(e,t,i,l,a,r)=>{(e=>{e.setPaintProperty("clicked_gap","line-opacity",0),e.setPaintProperty("selected_pois","circle-stroke-opacity",0),c("text-about-gap-click")})(e),((e,t)=>{let i=w()+"/nearby-gaps/?q="+t;P(e,i)})(e,i=parseInt(i)),L(t,i),((e,t)=>{let i=["in","eta_uid",t.toString()];e.setFilter("iso_sw",["all",i,o]),e.setFilter("iso_sw_outline",["all",i,o]),e.setFilter("iso_osm",["all",i,s]),e.setFilter("iso_osm_outline",["all",i,s]),(e=>{e.setPaintProperty("iso_sw","fill-opacity",.7),e.setPaintProperty("iso_osm","fill-opacity",.7),e.setPaintProperty("iso_sw_outline","line-opacity",.9),e.setPaintProperty("iso_osm_outline","line-opacity",.9)})(e)})(e,i),((e,t)=>{var i=["in","poi_uid",parseInt(t)];e.setFilter("selected_poi",i),e.setFilter("selected_poi_entrypoints",i)})(e,i),e.getCanvas().style.cursor="";let n="@ "+y(decodeURI(a));u(n,"subtitle");let _=g(r)+" sidewalk coverage";u(_,"selected-poi-ratio"),e.setPaintProperty("selected_poi","circle-stroke-opacity",.8),e.setPaintProperty("selected_existing_sidewalk","line-opacity",0),q(),p("info-box"),p("walkshed-legend"),p("gap-legend"),c("stat-box"),c("selected-legend"),d("text-about-gap-click")},R=e=>{e.on("click","sw",(function(t){e.getZoom()>A&&((e,t)=>{F(e,t.lngLat);var i=e.queryRenderedFeatures(t.point,{layers:["sw"]});e.getSource("selected_existing_sidewalk_data").setData(i[0].geometry),e.setPaintProperty("selected_existing_sidewalk","line-opacity",1),E(e,t.lngLat),r(e),e.setFilter("selected_poi",["==","type","none"]),e.setPaintProperty("clicked_gap","line-opacity",0),e.setFilter("selected_poi_entrypoints",["==","type","none - this filter should return zero results"]),u("This existing sidewalk:","gap-header"),c("stat-island"),u("Around an Existing Sidewalk","subtitle"),p("stat-box"),c("info-box"),c("walkshed-legend"),p("selected-legend")})(e,t)}))};mapboxgl.accessToken="pk.eyJ1IjoiZHZycGNvbWFkIiwiYSI6ImNrczZlNDBkZzFnOG0ydm50bXR0dTJ4cGYifQ.VaJDo9EtH2JyzKm3cC0ypA";const z={sidewalks:{id:"sw",attribute:"line-width",style:["interpolate",["exponential",.5],["zoom"],10,.01,17,3]},crosswalks:{id:"xwalk",attribute:"line-width",style:["interpolate",["exponential",.5],["zoom"],10,.05,18,6]},all_pois:{id:"all_pois",attribute:"circle-radius",style:["interpolate",["linear"],["zoom"],9.5,2.6,18,8]},all_pois_outline:{id:"all_pois",attribute:"circle-stroke-width",style:["interpolate",["linear"],["zoom"],9.5,.6,18,2]},selected_poi:{id:"selected_poi",attribute:"circle-radius",style:["interpolate",["linear"],["zoom"],10,5,18,20]},selected_poi_entrypoints:{id:"selected_poi_entrypoints",attribute:"circle-radius",style:["interpolate",["linear"],["zoom"],10,.1,18,4]},selected_poi_entrypoints_outline:{id:"selected_poi_entrypoints",attribute:"circle-stroke-width",style:["interpolate",["linear"],["zoom"],10,.1,18,1]}},B=e=>{var t=document.getElementById("dropdown_category");t.addEventListener("change",(function(){let i=h[t.value];if(u("@ "+i,"subtitle"),"all"==t.value)var o=null;else o=["==","category",t.value];e.setFilter("all_pois",o),n(e),["info-box","stat-box"].forEach((e=>{document.getElementById(e).style.setProperty("display","none")})),c("walkshed-legend"),e.setPaintProperty("selected-municipality","line-opacity",0),M(),document.getElementById("dropdown_muni").value="...",q(),e.flyTo({center:[-75.36277290123333,40.20129661107534],zoom:10,essential:!0}),c("gap-legend"),c("text-about-gap-click")}))},N=e=>{var t=document.getElementById("dropdown_muni");t.addEventListener("change",(function(){var i=t.value;u("in "+i,"subtitle"),x(e,i),((e,t)=>{let i=w()+"/gaps-within-muni/?q="+t.replace(" ","%20");P(e,i)})(e,i),v(e,i),n(e),p("gap-legend"),q(),d("text-about-gap-click")}))},I={type:"LineString",coordinates:[[-75.24747490882874,40.00070356410586],[-75.24741053581238,40.00072000146503],[-75.24736225605011,40.00075287617142]]},G=new mapboxgl.Map({container:"map",style:"mapbox://styles/dvrpcomad/cks6e6uk5dawe18rzxek2oyjf",center:[-75.36277290123333,40.20129661107534],zoom:9.5}),j=(()=>{const e=document.getElementById("barChart");return new Chart(e,{type:"bar",data:{labels:[""],datasets:[{label:"Using existing sidewalks",backgroundColor:"rgba("+t+", 0.5)",borderColor:"rgba("+t+", 0.5)",data:[50]},{label:"If every road had sidewalks",backgroundColor:"rgba("+i+", 0.5)",borderColor:"rgba("+i+", 0.5)",data:[100]}]},options:{indexAxis:"y",maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"square miles",padding:{bottom:10}}}}}})})();G.on("load",(function(){let t="road-label";L(j,"1007");for(const t in e)G.addSource(t,e[t]);for(const e in l)G.addLayer(l[e],t);k(G,t);for(const e in a)G.addLayer(a[e],t);for(const e in z)G.setPaintProperty(z[e].id,z[e].attribute,z[e].style);(e=>{e.addSource("selected_existing_sidewalk_data",{type:"geojson",data:I}),e.addLayer({id:"selected_existing_sidewalk",type:"line",source:"selected_existing_sidewalk_data",paint:{"line-color":"yellow","line-width":4,"line-opacity":0}})})(G),((e,t)=>{e.on("click","all_pois",(function(i){var o=i.features[0].properties;O(e,t,o.poi_uid,i.lngLat,o.poi_name,o.ab_ratio)}))})(G,j),(e=>{e.on("click","gaps",(function(t){if(e.getZoom()>A){var i=t.features[0].properties;H(e,i.uid,t.lngLat,i.island_count)}}))})(G),R(G),(e=>{["all_pois"].forEach((t=>((e,t)=>{e.on("mouseenter",t,(()=>e.getCanvas().style.cursor="pointer")),e.on("mouseleave",t,(function(t){e.getCanvas().style.cursor=""}))})(e,t))),e.on("mouseenter","all_pois",(function(t){var i=t.features[0].properties,o="<h3>"+y(i.poi_name)+"</h3>";o+="<p style='text-align: center;'> <span class='green-text bold'>"+_[i.category]+"</span><br />"+g(i.ab_ratio)+" sidewalk coverage</p>",C(e,o,t)})),e.on("mouseleave","all_pois",(function(e){M()})),e.on("mouseenter","gaps",(function(t){e.getZoom()>A&&(e.getCanvas().style.cursor="pointer",C(e,"<p class='italic centered'>Click this <span class='green-text'> gap </span> to learn more <br/> about nearby destinations</p>",t))})),e.on("mouseleave","gaps",(function(t){M(),e.getCanvas().style.cursor=""})),e.on("mouseenter","sw",(t=>{e.getZoom()>A&&(e.getCanvas().style.cursor="pointer",C(e,"<p class='italic centered'>Click this <span class='green-text'> existing sidewalk </span> to learn more <br/> about nearby destinations</p>",t))})),e.on("mouseleave","sw",(function(t){e.getCanvas().style.cursor="",M()}))})(G),B(G),N(G),(e=>{e.on("zoomend",(()=>{e.getZoom()>A?(d("text-about-gap-click"),c("text-about-zooming-in")):(c("text-about-gap-click"),d("text-about-zooming-in"))}))})(G)}))})();